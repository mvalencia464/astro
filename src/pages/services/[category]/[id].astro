---
import { env } from 'cloudflare:workers';
import { getCollection, render } from 'astro:content';
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Header from '../../../components/Header.astro';
import Footer from '../../../components/Footer.astro';

export const prerender = true;

// 1. Tell Astro which pages to build based on your Markdown files
export async function getStaticPaths() {
  const services = await getCollection('services');
  return services.map(entry => ({
    params: { 
      category: entry.data.category,
      id: entry.id 
    },
    props: { entry },
  }));
}

// 2. Grab the specific content for the current page
const { entry } = Astro.props;
const { Content } = await render(entry);

// Retrieve Turnstile Site Key from Cloudflare Worker Environment Variables
const turnstileSiteKey = (env as any)?.PUBLIC_TURNSTILE_SITE_KEY || process.env.PUBLIC_TURNSTILE_SITE_KEY || import.meta.env.PUBLIC_TURNSTILE_SITE_KEY || '';
---

<BaseLayout 
  title={entry.data.title} 
  description={entry.data.description}
  serviceName={entry.data.serviceName}
  cityName={entry.data.city}
>
  <Header />
  
  <main class="max-w-4xl mx-auto px-6 py-32">
    <article class="prose prose-stone prose-invert lg:prose-xl mx-auto">
      <Content />
    </article>
    
    <div class="mt-12 pt-12 border-t border-stone-800">
      <a href="/" class="text-orange-500 hover:text-orange-400 font-bold uppercase tracking-widest text-sm flex items-center gap-2">
        ‚Üê Back to Home
      </a>
    </div>
  </main>

  <Footer siteKey={turnstileSiteKey} />
</BaseLayout>
